(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[31],{451:function(e,t,a){"use strict";a.r(t);var n,c=a(191),r=a(117),o=a.n(r),i=a(118),s=a(109),l=a(291),d=a(424),b=a(435),u=a(436),j=a(2),f=a(166),O=a.n(f),p=a(5),h=a(101),m=a(110).a.div(n||(n=Object(h.a)(["\n  & .attach-group {\n    display: flex;\n    margin: 5px 0;\n  }\n\n  & .attach-button {\n    margin-left: 15px;\n    background-color: transparent;\n    border: none;\n    cursor: pointer;\n    &:hover {\n      color: #e74c3c;\n      transition: linear 0.2s;\n    }\n  }\n  & .button-group {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  img {\n    object-fit: contain;\n    width: 300px;\n    height: 400px;\n  }\n"]))),g=a(145),x=a(193),v=a(121),y=a(135),B=a(287),k=a(153),I=a(300),C=a(453),w=a(122),N=a(108),S=a(52),F=a(149),R=a(148),q=a(13);t.default=function(){var e=Object(p.g)(),t=Object(p.i)().param,a=Object(p.h)().search,n=O.a.parse(a),r=n.category,f=n.id,h=Object(j.useState)(),J=Object(s.a)(h,2),T=J[0],_=J[1],z=Object(j.useState)(),D=Object(s.a)(z,2),E=D[0],L=D[1],U=Object(j.useState)([]),A=Object(s.a)(U,2),G=A[0],H=A[1],K=Object(j.useState)(),M=Object(s.a)(K,2),P=M[0],Q=M[1],V=Object(j.useState)(),W=Object(s.a)(V,2),X=W[0],Y=W[1],Z=Object(j.useState)(),$=Object(s.a)(Z,2),ee=$[0],te=$[1],ae=Object(y.a)(""),ne=Object(s.a)(ae,3),ce=ne[0],re=ne[1],oe=ne[2],ie=Object(j.useState)(0),se=Object(s.a)(ie,2),le=se[0],de=se[1],be=Object(g.a)(v.b,{variables:{id:parseInt(f,10)}}),ue=be.loading,je=be.data,fe=be.refetch,Oe=Object(x.a)(N.c,{onCompleted:function(e){e.createImage.ok&&(de(0),fe&&fe())}}),pe=Object(s.a)(Oe,1)[0],he=Object(x.a)(N.g,{onCompleted:function(e){var t=e.deleteImage,a=t.ok,n=t.err;a?(fe&&fe(),S.b.error("\uc774\ubbf8\uc9c0\uac00 \uc0ad\uc81c \ub418\uc5c8\uc2b5\ub2c8\ub2e4")):(console.log(n),S.b.error(n))}}),me=Object(s.a)(he,1)[0],ge=Object(x.a)(N.b,{onCompleted:function(e){e.createFile.ok&&(de(0),fe&&fe())}}),xe=Object(s.a)(ge,1)[0],ve=Object(x.a)(N.f,{onCompleted:function(e){var t=e.deleteFile,a=t.ok,n=t.err;a?(S.b.success("\ud30c\uc77c\uc774 \uc0ad\uc81c \ub418\uc5c8\uc2b5\ub2c8\ub2e4"),fe&&fe()):(console.log(n),S.b.error(n))}}),ye=Object(s.a)(ve,1)[0],Be=Object(x.a)(N.i,{onCompleted:function(a){var n=a.editBoard,c=n.ok,o=n.err;c?(S.b.success("\uac8c\uc2dc\ubb3c\uc774 \uc218\uc815 \ub418\uc5c8\uc2b5\ub2c8\ub2e4"),e.push({pathname:"/admin/".concat(t,"/").concat(r),state:{refresh:!0}})):(console.log(o),S.b.error("\uac8c\uc2dc\ubb3c\uc744 \uc0ad\uc81c \ud560 \uc218 \uc5c6\uc2b5\ub2c8\ub2e4"))}}),ke=Object(s.a)(Be,1)[0],Ie=Object(j.useCallback)((function(){X&&X.trim()&&Object(R.a)("images",r,X,Q)}),[r,X]),Ce=Object(j.useCallback)(function(){var e=Object(i.a)(o.a.mark((function e(t){var a;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ie(),de(le+1),a=t.name,Y(t.name),Object(F.a)("images",t,r,a,Q,le,de,pe,parseInt(f,10));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[r,le,Ie,pe,f]),we=Object(j.useCallback)((function(e){de(1),w.a.ref("/files/".concat(r,"/").concat(e.name)).put(e).on("state_changed",(function(e){}),(function(e){return console.log(e)}),(function(){w.a.ref("/files/".concat(r,"/").concat(e.name)).getDownloadURL().then(function(){var t=Object(i.a)(o.a.mark((function t(a){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return H((function(t){return[].concat(Object(c.a)(t),[{url:a,fileName:e.name}])})),t.next=3,xe({variables:{url:a,fileName:e.name,boardId:parseInt(f,10)},onCompleted:function(e){var t=e.createFile,a=t.ok,n=t.err;a?(S.b.success("\ud30c\uc77c\uc774 \uc5c5\ub85c\ub4dc \ub418\uc5c8\uc2b5\ub2c8\ub2e4"),fe&&fe()):(S.b.error("\ud30c\uc77c \uc5c5\ub85c\ub4dc\uc5d0 \uc2e4\ud328 \ud558\uc600\uc2b5\ub2c8\ub2e4"),console.log(n))}});case 3:de(le-1);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))}),[xe,f,r,le,fe]),Ne=Object(j.useCallback)(function(){var e=Object(i.a)(o.a.mark((function e(t,a){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return w.a.ref("/files/".concat(r,"/").concat(a)).delete(),e.next=3,ye({variables:{id:t}});case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),[ye,r]);return Object(j.useEffect)((function(){var e;(je&&je.getBoardById&&je.getBoardById.data&&(_(je.getBoardById.data),oe(je.getBoardById.data.link||"")),je&&je.getBoardById&&je.getBoardById.data&&je.getBoardById.data.files&&L(je.getBoardById.data.files),je&&je.getBoardById&&je.getBoardById.data&&je.getBoardById.data.images)&&(te(je.getBoardById.data.images[0]),Y(null===(e=je.getBoardById.data.images[0])||void 0===e?void 0:e.fileName))}),[je,_,oe]),ue?Object(q.jsx)("div",{children:"loading..."}):Object(q.jsxs)(m,{children:[Object(q.jsxs)("div",{className:"button-group",children:[Object(q.jsx)(B.a,{type:"ghost",onClick:function(){return e.goBack()},children:"\ub4a4\ub85c"}),Object(q.jsx)(B.a,{type:"primary",disabled:0!==le,onClick:function(){return ke({variables:{id:parseInt(f,10),link:ce.includes("http")?ce:"http://".concat(ce)}})},children:0===le?"\uc644\ub8cc":Object(q.jsxs)(q.Fragment,{children:[Object(q.jsx)(k.a,{})," \ud30c\uc77c / \uc774\ubbf8\uc9c0 \uc5c5\ub85c\ub529 \uc911"]})})]}),Object(q.jsxs)(l.b,{bordered:!0,column:{xxl:4,xl:3,lg:3,md:3,sm:2,xs:1},layout:"horizontal",children:[Object(q.jsx)(l.b.Item,{label:"\ub9c1\ud06c",span:4,labelStyle:{width:100},children:Object(q.jsx)(d.a,{placeholder:(null===T||void 0===T?void 0:T.link)||void 0,value:ce,onChange:re})}),Object(q.jsxs)(l.b.Item,{label:"\ucca8\ubd80\ud30c\uc77c",span:4,labelStyle:{width:100},children:[E&&0!==E.length?Object(q.jsx)(q.Fragment,{children:E.map((function(e,t){return Object(q.jsxs)("div",{className:"attach-group",children:[Object(q.jsx)("a",{href:null===e||void 0===e?void 0:e.url,download:!0,target:"_blank",rel:"noreferrer",children:null===e||void 0===e?void 0:e.fileName}),Object(q.jsx)("button",{className:"attach-button",onClick:function(){return Ne(null===e||void 0===e?void 0:e.id,null===e||void 0===e?void 0:e.fileName)},children:Object(q.jsx)(I.a,{})})]},t)}))}):0===G.length?Object(q.jsx)("div",{children:"\ucca8\ubd80\ud30c\uc77c \uc5c6\uc74c"}):Object(q.jsx)(q.Fragment,{}),Object(q.jsx)(b.a,{multiple:!0,maxCount:4,className:"upload-list-inline",customRequest:function(e){var t=e.file;return we(t)},onChange:function(e){var t=e.file;0!==G.length?t.status="done":t.status="removed"},children:Object(q.jsx)(B.a,{icon:Object(q.jsx)(C.a,{}),children:"\ud30c\uc77c \uc5c5\ub85c\ub4dc"})})]}),Object(q.jsxs)(l.b.Item,{label:"\uc774\ubbf8\uc9c0",span:4,labelStyle:{width:100},children:[ee&&Object(q.jsx)(B.a,{danger:!0,icon:Object(q.jsx)(I.a,{}),onClick:function(){Object(R.a)("images",r,ee.fileName,Q),me({variables:{id:ee.id}})},children:"\uc774\ubbf8\uc9c0 \uc0ad\uc81c"}),Object(q.jsx)(b.a,{listType:"picture",customRequest:function(e){var t=e.file;ee&&me({variables:{id:ee&&ee.id}}),Ce(t)},progress:{showInfo:!0},onChange:function(e){var t=e.file;t.status=P?"done":"removed"},maxCount:1,children:Object(q.jsx)(B.a,{icon:Object(q.jsx)(C.a,{}),children:"\uc774\ubbf8\uc9c0 \uc5c5\ub85c\ub4dc"})}),ee?Object(q.jsx)("img",{src:ee.url,alt:ee.fileName}):Object(q.jsx)(u.a.Text,{children:"\uc5c5\ub85c\ub4dc \ub41c \uc774\ubbf8\uc9c0\uac00 \uc5c6\uc2b5\ub2c8\ub2e4"})]})]})]})}}}]);
//# sourceMappingURL=31.baa29f31.chunk.js.map